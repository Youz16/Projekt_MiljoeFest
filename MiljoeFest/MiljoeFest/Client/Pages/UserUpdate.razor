@page "/userupdate"
@using MiljoeFest.Client.Shared
@using MiljoeFest.Shared
@using System.Net.Http.Json
@inject HttpClient Http
@inject StateContainer StateContainer;

<PageTitle>Miljø Fest | Bruger Info</PageTitle>
<h1>Bruger Info</h1>

<p>Indtast venligst de krævede oplysninger.</p>
<!--Oprettelse af form som følger modellen for obj "u"-->
<EditForm Model="@StateContainer" OnValidSubmit="update">
    
    <label>Fulde navn:</label>
    <div>
        <InputText @bind-Value="@StateContainer.Name" placeholder="Navn"/>
    </div>
    
    <label>Brugertype:</label>
    <div>
        <InputNumber @bind-Value="@StateContainer.RoleId" readonly/>
    </div>

    <label>Afdeling:</label>
    <div>
        <InputText @bind-Value="@StateContainer.Department" placeholder="Ønskede afdeling"/>
    </div>

    <label>E-mail:</label>
    <div>
        <InputText @bind-Value="@StateContainer.Email" placeholder="adresse@email.com"/>
    </div>
    
    <label>Mobil:</label>
    <div>
        <InputText @bind-Value="@StateContainer.Phone" placeholder="12 34 56 78"/>
    </div>
    
    <label>Kompetencer:</label>
    <div>
        <InputText @bind-Value="@StateContainer.Skills" placeholder="Ledelse, marketing e.l."/>
    </div>

    <label>Fødselsdato:</label>
    <div>
        <InputDate @bind-Value="@StateContainer.BirthDay" min="1960-01-01"/>
    </div>

    <label>Førstehjælpsbevis:</label>
    <div>
        <InputCheckbox @bind-Value="@StateContainer.FirstAid"/>
    </div>
    
    <!--Knap sender info til db og redirecter bruger til forsiden igen (href = "/")-->
    <button type="submit" class="btn btn-success mt-3" href="/">
        @updateAlert
    </button>
    <button class="btn btn-danger" @onclick="delete">@deleteAlert</button>
</EditForm>

@code {
    public string updateAlert = "Opdater";

    public string deleteAlert = "Slet bruger";

    public async Task delete()
    {
        if (StateContainer.UserId == 1)
        {
            await Http.DeleteAsync($"userController/delete?userId={StateContainer.UserId}");
            deleteAlert = "Brugeren blev slettet";
        }
        else
        {
            deleteAlert = "Du har ikke rettigheder til at udføre den valgte handling";
        }
    }

    public async Task update()
    {
        // Sender obj "u" afsted med de oplysninger fra bindede inputfelter i EditFormen ovenover
        await Http.PutAsJsonAsync($"userController/update?userId={StateContainer.UserId}", StateContainer);
        updateAlert = "Bruger Opdateret";
    }
}
